"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var keyValuePairsToObject=function(e){var a={};return e&&(-1===e.indexOf("=")||e.replace(/([^=&]+)=([^&]*)/gi,function(e,t,i){a[t]=i})),a},parseSviForVisitorId=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").split("|");return e[1]&&0<=e[1].indexOf("[")?e[1].split("[")[0]:""},buildCmsIdentifier=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"|";return e&&e.dataset&&e.dataset.templateId?"".concat((e.dataset.templateId||"").trim()).concat(t).concat((e.dataset.comVersion||"").trim()).concat(t).concat((e.dataset.autoSel||"").trim()).concat(t).concat((e.dataset.instanceVersion||"").trim()):e&&e.dataset&&e.dataset.comId?e.dataset.comId.trim():null},thisEventShouldBeacon=function(e,t){var i=e.srcElement||e.originalTarget||e.target;if("click"===e.type&&function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e&&1<e.detail}(e))return!1;var a=i.matches(t),r=i.closest(t);return!(!a&&!r)&&(!(!i.parentElement||i.closest("[data-template-id='widget']"))&&!(a?i:r).classList.contains("suppress-default-beacon"))},gatherComponentIds=function(){for(var e=document.querySelectorAll("[data-com-id]"),t=e.length,i=[],a=0;a<t;a+=1){var r=buildCmsIdentifier(e[a],":");i.push(r)}return i.length?i.join("|"):null},parseTTSku=function(){var e={sku:null,screen_object_state:null},t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").split(",");return t[0]&&(e.sku=t[0].trim()),t[1]&&(e.screen_object_state=t[1].trim()),e},getKeyword=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.hasOwnProperty("q")?e.q:""},getElementText=function(e){return e?"SELECT"===e.tagName&&0<=e.selectedIndex&&e.options?e.options[e.selectedIndex]?e.options[e.selectedIndex].text:"":"SELECT"===e.tagName?"":"checkbox"===e.type||"radio"===e.type?(e.parentElement.textContent||"").trim():(e.textContent||e.getAttribute("aria-label")||"").trim():""},FormatPageData=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";_classCallCheck(this,i),this.pageData=e,this.pathName=t,this.pageData.categoryName=this.pageData.categoryName||this.convertPathForLegacyPages(),this.pageData.pageId=this.pageData.routeId||this.pageData.pageName||this.beautifyPath()}return _createClass(i,[{key:"convertPathForLegacyPages",value:function(){return"/"===this.pathName?"Homepage":0===this.pathName.indexOf("/tax-tips")?"Articles":this.isProductsAndPricePage()?"Product and Pricing Pages":0===this.pathName.indexOf("/tax-tools")?"Tools":0===this.pathName.indexOf("/taxfreedom")?"TaxFreedom":0===this.pathName.indexOf("/microsite")?"Microsite Pages":0===this.pathName.indexOf("/lp/")?"Campaign Landing Pages":"Other"}},{key:"isProductsAndPricePage",value:function(){return 0<=this.pathName.indexOf("/personal-taxes")||0<=this.pathName.indexOf("/small-business-taxes")}},{key:"beautifyPath",value:function(){return"/"===this.pathName?"homepage":this.pathName.replace(/[^a-zA-Z0-9 ]/g," ")}}]),i}(),gatherPageData=function(e){var t=document.querySelector("[data-com-type='page']")||{dataset:{}},i=document.body.dataset||{},a=new FormatPageData(t.dataset,e);return a.pageData.siteId=a.pageData.siteId||i.siteId,a.pageData},isFFA=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=!1;return("TaxFreedom"===e||t&&0<=t.indexOf("freefile.intuit.com"))&&(i=!0),i},formatPlugins=function(e){if(!e)return"";for(var t=[],i=e.length,a=0;a<i;a+=1){var r=e[a];t.push(r.name)}return t.join("|")},ContextHandler=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.win=e.win||{},this.siteId=e.siteId||"",this.immutableContext={},this.timezone="",this.integrations={},this.userDefindedContext={},this.exec()}return _createClass(t,[{key:"exec",value:function(){this.setTimezone(),this.setImmutableContext()}},{key:"setIntegration",value:function(e,t){this.integrations[e]=t}},{key:"setContext",value:function(e,t){this.userDefindedContext[e]=t}},{key:"setTimezone",value:function(){this.win.Intl&&this.win.Intl.DateTimeFormat&&(this.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone)}},{key:"setImmutableContext",value:function(){var e={};e.timezone=this.timezone,e.ecs_version="4.0",this.immutableContext=e}},{key:"getContext",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t={};return t.browser_pixel_density=e.devicePixelRatio||"",t.integrations=this.integrations,e.navigator&&(t.locale=e.navigator.language),e.screen&&(t.screen_height=e.screen.height,t.screen_width=e.screen.width),Object.assign(t,this.userDefindedContext,this.immutableContext)}}]),t}(),AdobeVisitorApiInit=function(){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,i),this.config=e,this.Visitor=t,this.visitor=null,this.visitorConfigProperties={},this.fetchMCMIDPromise=null,this.MCMID=null,this.visitorIds=null,this.exec()}return _createClass(i,[{key:"exec",value:function(){this.visitorConfigProperties={trackingServer:this.config.trackingServer,trackingServerSecure:this.config.trackingServerSecure},this.config.cname&&this.config.cname.enabled&&(this.visitorConfigProperties.marketingCloudServer=this.config.trackingServer,this.visitorConfigProperties.marketingCloudServerSecure=this.config.trackingServerSecure),this.config.enabled&&!this.requirementsForExecAreMissing()&&(this.visitor=this.Visitor.getInstance(this.config.marketingCloudOrgId,this.visitorConfigProperties),this.visitorIds=this.visitor.appendVisitorIDsTo("?").substring(1))}},{key:"requirementsForExecAreMissing",value:function(){return this.Visitor.getInstance?!this.config.marketingCloudOrgId&&"config.marketingCloudOrgId is not present":"Visitor.getInstance is not defined"}},{key:"fetchMCMID",value:function(){var r=this;this.fetchMCMIDPromise=new Promise(function(t,e){if(r.visitor&&r.visitor.getVisitorValues){var i=[r.visitor.FIELDS.MCMID];r.config.ssf&&r.config.ssf.enabled&&i.push(r.visitor.FIELDS.MCAAMLH);var a=setTimeout(function(){e("AdobeVisitorApi visitor.getVisitorValues took longer than ".concat(r.config.visitorMCMIDTimeout,"ms to return a response."))},r.config.visitorMCMIDTimeout);r.visitor.getVisitorValues(function(e){clearTimeout(a),r.MCMID=e.MCMID,r.MCAAMLH=e.MCAAMLH,t(e)},i)}else e("visitor and/or visitor.getVisitorValues is not defined")})}}]),i}(),UpdateLoginUrl=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.ivid=e.ivid,this.originalUrl=e.url||"",this.domain=this.originalUrl.split("?")[0],this.adobeVisitorKeyValuePair=e.adobeVisitorKeyValuePair,this.updatedUrl=e.url||"",this.uriParams={},this.urlRegexForParams=/\?(.+)/,this.encodedUriParamString="",this.exec()}return _createClass(t,[{key:"exec",value:function(){var e=this.originalUrl.split(this.urlRegexForParams)[1];this.uriParams=keyValuePairsToObject(e),this.uriParams.redirect_url&&(this.ivid||this.adobeVisitorKeyValuePair)&&this.addParamsToRedirLink()}},{key:"decodeUriParams",value:function(){var t=this,e=Object.keys(this.uriParams),i={};e.forEach(function(e){i[e]=decodeURIComponent(t.uriParams[e])}),this.uriParams=i}},{key:"encodeUriParams",value:function(){var t=this,i=[];Object.keys(this.uriParams).forEach(function(e){i.push("".concat(e,"=").concat(encodeURIComponent(t.uriParams[e])))}),this.encodedUriParamString=i.join("&")}},{key:"addParamsToRedirLink",value:function(){var e="".concat(this.domain,"?");this.decodeUriParams();var t="".concat(this.uriParams.redirect_url);this.adobeVisitorKeyValuePair&&(t+=this.adobeVisitorKeyValuePair),this.ivid&&(t+="&ivid=".concat(this.ivid)),this.uriParams.redirect_url=t,this.encodeUriParams(),e+=this.encodedUriParamString,this.updatedUrl=e}}]),t}(),PropertiesHandler=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};_classCallCheck(this,t),this.immutableProperties={},this.ivid=e.ivid,this.siteId=e.siteId,this.scopeApplicationVersion=e.scopeApplicationVersion||"",this.scopeArea=e.scopeArea||"",this.subScopeArea=e.subScopeArea||null,this.screen=e.screen,this.aamSegmentIds=e.aamSegmentIds,this.personalizationIds=e.personalizationIds,this.mlModelName=e.mlModelName||null,this.mlModelVersion=e.mlModelVersion||null,this.mlModelResponse=e.mlModelResponse||null,this.properties={},this.initImmutableProperties(),this.setDefaultEventProperties()}return _createClass(t,[{key:"initImmutableProperties",value:function(){this.addImmutableProperty("aam_segment_ids",this.aamSegmentIds),this.addImmutableProperty("event_sender_purpose","mktg"),this.addImmutableProperty("event_sender_name","martech"),this.addImmutableProperty("event_sender_version","1.0.0"),this.addImmutableProperty("ivid",this.ivid),this.addImmutableProperty("ml_model_name",this.mlModelName),this.addImmutableProperty("ml_model_version",this.mlModelVersion),this.addImmutableProperty("ml_model_response",this.mlModelResponse),this.addImmutableProperty("org","cg"),this.addImmutableProperty("personalization_ids",this.personalizationIds),this.addImmutableProperty("platform","web"),this.addImmutableProperty("purpose","mktg"),this.addImmutableProperty("scope",this.siteId),this.addImmutableProperty("scope_application_version",this.scopeApplicationVersion),this.addImmutableProperty("scope_version","".concat(this.siteId,":").concat(this.scopeApplicationVersion)),this.addImmutableProperty("screen",this.screen),this.addImmutableProperty("scope_area",this.scopeArea.toLocaleLowerCase()),this.addImmutableProperty("sub_scope_area",this.subScopeArea),this.addImmutableProperty("page_hierarchy","".concat(this.immutableProperties.org,"|").concat(this.immutableProperties.purpose,"|").concat(this.immutableProperties.scope,"|").concat(this.immutableProperties.scope_area,"|").concat(this.immutableProperties.screen))}},{key:"addImmutableProperty",value:function(e,t){return!this.isExistingImmutableProperty(e)&&(null!=t?(this.immutableProperties[e]=t,this.properties[e]=t,!0):void 0)}},{key:"addProperty",value:function(e,t){return!this.isExistingImmutableProperty(e)&&(null!=t?(this.properties[e]=t,!0):void 0)}},{key:"setDefaultEventProperties",value:function(){this.properties.action="viewed",this.properties.object="content",this.properties.event_class="user_action",this.properties.url_query_param=""}},{key:"isExistingImmutableProperty",value:function(e){return this.immutableProperties.hasOwnProperty(e)}},{key:"resetMutableProperties",value:function(){this.properties=Object.assign({},this.immutableProperties),this.setDefaultEventProperties()}}]),t}(),formatAamSegments=function(e){return e?e.replace(/\|/g,":"):null};!function(t){var n,h,o=t.appVars,g=t.Cookies,e=t.Visitor,i=t.coreServiceAdapter,s=g.get("ivid"),a=g.get("ivid_b")||null,r={},c=0,d=o.segment.timeout||3e3,l="EMS".concat(o.pageview.experienceId?"|CMS":"","~2.0"),u="a, button",m="input[type='checkbox'], input[type='radio'], select",v="".concat(u,", ").concat(m),p=!(!o.segment||!o.segment.clientSideLogging),f="",y=null,b=null,P={},I=window.analytics||{};o.seasonal=o.seasonal||{},o.article=o.article||{};var _=function(e){window.coreServiceAdapter&&p&&window.coreServiceAdapter.logger.error("clientSideJsError",{prettyMessage:"Client-side unexpected analytics error!",logKey:"analyticsHandledException",logValue:"string"==typeof e?e:JSON.stringify(e),errorMessage:"handledException",userAgent:navigator&&navigator.userAgent?navigator.userAgent:"",pageUrl:window.location&&window.location.href?window.location.href:""})},C=new Promise(function(e,t){var i=d/100,a=setInterval(function(){window.analytics&&window.analytics.initialized?(I=window.analytics,e(),clearInterval(a)):i<0?(t("Segment did not load within ".concat(d," milliseconds.")),clearInterval(a)):i--},100)}),k=function(){var e=h.properties;e.type="page",window.coreServiceAdapter.analytics.trackEvent(e)},w=function(e){I&&I.track&&(!function(e){var t,i=e.srcElement||e.explicitOriginalTarget||e.originalTarget||e.target,a=i.matches(v)?i:i.closest(v),r=parseTTSku(g.get("tt_sku_s")),n="",o="",s="",c=null,d="",l="change"===e.type?"selected":"".concat(e.type,"ed"),u=null,m=null;a&&(s=a.getAttribute("data-ui-object")||("A"===a.tagName?"link":a.tagName),t=a.closest("[data-com-id]")),t&&(n=buildCmsIdentifier(t),o=buildCmsIdentifier(t,":"),u=t.parentElement.closest("[data-com-id]")),!s&&t&&(s=t.tagName),u&&(c=buildCmsIdentifier(u),d=buildCmsIdentifier(u,":")),a&&(m=getElementText(a)),h.addProperty("object_detail",n),h.addProperty("action","engaged"),h.addProperty("type","click"),h.addProperty("ui_action",l),h.addProperty("ui_object",s),h.addProperty("ui_object_detail","".concat(l," ").concat(m)),h.addProperty("ui_access_point",c),h.addProperty("sku",null),h.addProperty("recommended_sku",r.sku),h.addProperty("screen_object_state",r.screen_object_state);var p=h.properties;h.addProperty("action_detail","".concat(p.action,"|").concat(p.object,"|").concat(o,"|").concat(p.ui_action,"|").concat(p.ui_object,"|").concat(p.ui_object_detail,"|").concat(d))}(e),i.analytics.trackEvent(h.properties))},x=function(){for(var e=document.querySelectorAll("a[href^='https://".concat("accounts.intuit.com","']")),t=e.length,i=0;i<t;i+=1){var a=e[i],r=a.getAttribute("href"),n=new UpdateLoginUrl({url:r,ivid:s,adobeVisitorKeyValuePair:b?b.visitorIds:""});a.setAttribute("href",n.updatedUrl)}},A=function(e){var t=e.MCMID,i=e.MCAAMLH;if(I&&I.user){I.user().anonymousId(s);var a=parseSviForVisitorId(g.get("s_vi")),r={marketingCloudVisitorId:t};a&&(r.visitorId=a),i&&(r.imsregion=i),o.adobeVisitorApi.ssf&&o.adobeVisitorApi.ssf.enabled&&n.setContext("ssf",0),n.setIntegration("Adobe Analytics",r),k(),x()}},S=function(){var e;h=new PropertiesHandler({ivid:s,siteId:P.siteId,scopeApplicationVersion:l,scopeArea:P.categoryName,subScopeArea:P.subCategory,screen:P.pageId?P.pageId.trim():null,aamSegmentIds:formatAamSegments(o.clientProfile.aam_incoming_segments),personalizationIds:o.clientProfile.decision_audience||null,mlModelName:o.mxs.modelName,mlModelVersion:o.mxs.modelVersion,mlModelResponse:Number(o.mxs.modelEvaluation)||null}),e=gatherComponentIds(),h.addImmutableProperty("application_locale",o.locale),h.addImmutableProperty("browser_encoding",document.characterSet?document.characterSet.toUpperCase():null),h.addImmutableProperty("browser_java_enabled",t.navigator.javaEnabled?t.navigator.javaEnabled():null),h.addImmutableProperty("browser_height",t.innerHeight),h.addImmutableProperty("browser_width",t.innerWidth),h.addImmutableProperty("campaign",r.cid?encodeURI(r.cid):null),h.addImmutableProperty("content_id",o.article&&o.article.id?o.article.id:null),h.addImmutableProperty("component_ids",e),h.addImmutableProperty("cms_locator",buildCmsIdentifier(y)),h.addImmutableProperty("experiment_ids",g.get(o.experience.cookieName||"tms")||null),h.addImmutableProperty("is_amp",document.documentElement.hasAttribute("amp")),h.addImmutableProperty("is_ffa",isFFA(P.categoryName,document.location.href||"")),h.addImmutableProperty("ivid_b",a),h.addImmutableProperty("keyword",getKeyword(r)),h.addImmutableProperty("page_experience",P.experienceAnalyticsName||null),h.addImmutableProperty("page_language",document.documentElement.lang),h.addImmutableProperty("priority_code",g.get("priorityCode")||null),h.addImmutableProperty("referrer",document.referrer),h.addImmutableProperty("screen_color_depth",t.screen.colorDepth),h.addImmutableProperty("url_host_name",t.location.hostname),h.addImmutableProperty("url_query_param",f),h.addProperty("tax_prep_year",o.seasonal.taxYear?"ty".concat(o.seasonal.taxYear.substr(-2)):null),t.navigator&&(h.addProperty("browser_cookies_enabled",!!t.navigator.cookieEnabled),h.addProperty("browser_plugins",formatPlugins(t.navigator.plugins))),o.article.id&&(h.addProperty("topic_id",o.article.id),h.addProperty("topic_name",o.article.category))},M=function(){y=document.querySelector("[data-com-type='page']"),P=gatherPageData(document.location.pathname),f=t.location.search?t.location.search.substring(1):"",r=keyValuePairsToObject(f),(n=new ContextHandler({win:{navigator:window.navigator,Intl:window.Intl,location:window.location},siteId:P.siteId})).setContext("ivid",s),n.setContext("ssf",1),S(),x(),C.then(function(){o.adobeVisitorApi.enabled?((b=new AdobeVisitorApiInit(o.adobeVisitorApi,e)).fetchMCMID(),b.fetchMCMIDPromise).then(A).catch(function(e){_(e),k()}):k(),document.addEventListener("click",function(e){try{thisEventShouldBeacon(e,u)&&w(e)}catch(e){_(e)}},!1),document.addEventListener("change",function(e){thisEventShouldBeacon(e,m)&&w(e)})}).catch(_)};o.segment.enabled&&(window.coreServiceAdapter.analytics.registerListener(function(t){if(!window.analytics&&0===c)return _("window.analytics is not defined in analytics-init.js"),c++,void setTimeout(function(){c=0},1e3);if(!(0<c)){h.resetMutableProperties(),Object.keys(t).map(function(e){h.addProperty(e,t[e])});var e=n.getContext(window);switch(t.type){case"page":I.page(P.categoryName,P.pageId,t,e);break;case"identify":I.identify(t.userId,t.traits,e);break;case"alias":I.alias(t.userName,t.oldUserName,e);break;case"group":I.group(t.groupId,t,e);break;case"track":default:I.track("".concat(t.object,":").concat(t.action),h.properties,e)}}}),"loading"===document.readyState?document.addEventListener("DOMContentLoaded",M):M())}(window);